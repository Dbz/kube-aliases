#!/bin/bash

# Search deployments using regular expression

# TODO
function usage {
  echo "Usage: kdfind [ar] [regex]"
  echo "Regex search pods in namespace(s)."
}


while getopts "ra:?h" opt; do
  case $opt in
    a)
      regex=$OPTARG
      ;;

    # Find all deployments that are not ready
    r)
      column -t <<< $(kubectl get deployments --all-namespaces \
        | kdready.awk)
      exit 0
      ;;

    h|\?)
      # echo "Invalid option: -$OPTARG" >&2
      usage
      exit 0
      ;;
  esac
done


if [ -n "${regex}" ]
then
  column -t <<< $(kubectl get deployments --all-namespaces | \
    kpfind.awk -v regex="${regex}")
else
  column -t <<< $(kubectl get deployments | kdfind.awk -v regex="${1}")
fi
